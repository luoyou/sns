define(function(require,exports,module){  var $ = require('jquery');  var c = require('modules/candian');  var x = require('plugs/xheditor/xheditor')($);  var upload = require('upload')($);  require('uploadcss');  require('plugs/jquery.tmpl')($);  require('plugs/calendar/calendar.css');  require('plugs/calendar/script_calendar')($);    var FAV = require('plugs/form_and_validation');    var Release = c.Controller.create();  Release.include({    elements: {	  '#upload': 'upload',	  '#upload_thumb': 'upload_thumb',	  '#upload_group': 'upload_group'	},	events: {	  'change #cat_pid': 'goods_cat_post',	  'submit #releaseFrm': 'checkFrm',	  'click .thumb_dl': 'del_thumb'	},	init: function(){	  	  this.setUpload();	  this.setThumbUpload();	  this.setGroupUpload();	  this.setXheditor();	},	setXheditor: function(){	  $('#content').xheditor({	    tools:'simple',        skin:'default',        showBlocktag:true,        internalScript:false,        internalStyle:false,        width:500,        height:250,        fullscreen:false,        sourceMode:false,        forcePtag:true,        upImgUrl:"/ajax_xheditor",        upImgExt:"jpg,jpeg,gif,png" 	  });	},	setUpload: function(){	  var cObj;	  	  cObj = this;	  this.upload.uploadify({	    auto:true,		uploader:"/ajax_upload",		swf:zxPath+"plugs/uploadify/uploadify.swf",		debug : false,		fileSizeLimit : "1MB",		buttonText : "上传主图片",		removeCompleted : false,		fileTypeExts : "*.jpg;*.png;*.gif",		queueSizeLimit : 1,		uploadLimit : 999999,		onUploadSuccess : function(file, data,response) {			data = eval("(" +data +")");			if(data.success){				cObj.insertUpload(file, data);			}else{							}		},		onUploadError : function(file, errorCode,errorString,errorMsg) {			//alert("file="+ file +";errorCode="+ errorCode +";errorString="+ errorString +";errorMsg="+ errorMsg);		}	  });	},	insertUpload: function(file, data){	  var queue,swfObj,html;	  	  queue = $('#upload-queue');	  swfObj = $('#'+ file.id);	  if(swfObj.prevAll().get()){		swfObj.prevAll().remove();	  }	  swfObj.css('display','none');	  html = "<div style='position:relative;top:-16px;'><img src='"+ basePath +"images/uploadFiles/goods/goods/"+ data.name+"_160"+ data.fileType +"' /><input type='hidden' name='goods_img' value='"+data.name + data.fileType+"' /></div>";	  swfObj.append(html).css('display', 'inline-block');	  	},	setThumbUpload: function(){	  var cObj;	  	  cObj = this;	  this.upload_thumb.uploadify({	    auto:true,		uploader:"/ajax_upload_thumb",		swf:zxPath+"plugs/uploadify/uploadify.swf",		debug : false,		fileSizeLimit : "1MB",		buttonText : "上传缩略图片",		removeCompleted : false,		fileTypeExts : "*.jpg;*.png;*.gif",		queueSizeLimit : 10,		uploadLimit : 999999,		onUploadSuccess : function(file, data,response) {			data = eval("(" +data +")");			if(data.success){				cObj.insertUploadThumb(file, data);			}else{							}		},		onUploadError : function(file, errorCode,errorString,errorMsg) {			//alert("file="+ file +";errorCode="+ errorCode +";errorString="+ errorString +";errorMsg="+ errorMsg);		}	  });	},	insertUploadThumb: function(file, data){	  var queue,swfObj,html;	  	  queue = $('#upload_thumb-queue');	  swfObj = $('#'+ file.id);	  swfObj.css('display','none');	  html = "<div class='thumb_img' style='position:relative;top:-16px;'><img src='"+ basePath +"images/uploadFiles/goods/goods_thumb/"+ data.name+"_160"+ data.fileType +"' /><input type='hidden' name='thumb_img' value='"+data.name + data.fileType+"' /></div>";	  swfObj.append(html).css('display', 'inline-block');	},	setGroupUpload: function(){      var cObj;	  	  cObj = this;	  this.upload_group.uploadify({	    auto:true,		uploader:"/ajax_upload_group",		swf:zxPath+"plugs/uploadify/uploadify.swf",		debug : false,		fileSizeLimit : "1MB",		buttonText : "上传团购图片",		removeCompleted : false,		fileTypeExts : "*.jpg;*.png;*.gif",		queueSizeLimit : 1,		uploadLimit : 999999,		onUploadSuccess : function(file, data,response) {			data = eval("(" +data +")");			if(data.success){				cObj.insertUploadGroup(file, data);			}else{							}		},		onUploadError : function(file, errorCode,errorString,errorMsg) {			//alert("file="+ file +";errorCode="+ errorCode +";errorString="+ errorString +";errorMsg="+ errorMsg);		}	  });	},	insertUploadGroup: function(file, data){      var queue,swfObj,html;	  	  queue = $('#upload_group-queue');	  swfObj = $('#'+ file.id);	  if(swfObj.prevAll().get()){		swfObj.prevAll().remove();	  }	  swfObj.css('display','none');	  html = "<div style='position:relative;top:-16px;'><img style='width:233px;height:160px' src='"+ basePath +"images/uploadFiles/group/group/"+ data.name+"_233_160"+ data.fileType +"' /><input type='hidden' name='group_img' value='"+data.name + data.fileType+"' /></div>";	  swfObj.append(html).css('display', 'inline-block');	},	goods_cat_post: function(event){	  var target,cTarget,cObj,url,dataPost;	  	  target = $(event.target);	  cTarget = $(event.currentTarget);	  cObj = this;	  if(target.val()!=''){	    url = "/ajax_cat";		dataPost = "cat_pid="+ target.val();		cObj.zxAjaxLoad(url,dataPost,'',function(dataJson){		  if(dataJson.success){		    cObj.goods_cat_clear();			var catHtml = $('#catTmpl').tmpl(dataJson.cats);			$('#cat_id').append(catHtml);		  }else{		    alert(dataJson.msg);		  }		});	  }else{	    cObj.goods_cat_clear();	  }	},	goods_cat_clear: function(){	  $('#cat_id option').each(function(){		if($(this).val()!='') $(this).remove();      });	},	checkFrm: function(event){	  return FAV.checkForm(event.target);;	},	del_thumb: function(event){	  var target = $(event.target);	  var cTarget = $(event.currentTarget);	  var cObj = this;	  if(target.hasClass('thumb_del')){	    if(confirm('确定要删除？')){		  cTarget.remove();		  cObj.goods_thumb_status();		}	  }	},	goods_thumb_status: function(){	  var thumb_dl;	  	  thumb_dl = $('.thumb_dl');	  if(!thumb_dl.get().length){	    $('#goods_thumb_ed').remove();	  }	}  });    $(function(){    Release.init({el: $('#release')});	FAV.form_valid($);  });});